<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quiz Segurança Digital - Terceira Idade</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f4f8;
    margin: 0; padding: 20px;
    color: #333;
    display: flex;
    justify-content: center;
  }
  #container {
    background: white;
    max-width: 600px;
    width: 100%;
    border-radius: 10px;
    padding: 25px 30px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
  h2, h3 { color: #005a87; }
  label { display: block; margin: 15px 0 5px; font-weight: 600; }
  input[type=text], input[type=number] {
    width: 100%;
    padding: 12px 10px;
    font-size: 1.1em;
    border: 1.8px solid #ccc;
    border-radius: 6px;
    transition: border-color 0.3s;
  }
  input[type=text]:focus, input[type=number]:focus {
    border-color: #005a87;
    outline: none;
  }
  button {
    cursor: pointer;
    margin: 10px 10px 0 0;
    padding: 12px 24px;
    font-size: 1.1em;
    border: none;
    border-radius: 7px;
    background-color: #007acc;
    color: white;
    transition: background-color 0.3s;
  }
  button:hover:not(:disabled) { background-color: #005a87; }
  button:disabled { background-color: #a3c1db; cursor: default; }
  #feedbackBox {
    margin-top: 15px;
    font-weight: 700;
    font-size: 1.1em;
  }
  #feedbackBox.correct { color: #2d7a2d; }
  #feedbackBox.wrong { color: #c0392b; }
  #userInfo {
    margin-bottom: 20px;
    font-weight: 600;
    color: #004c6d;
  }
  #quizScreen, #resultScreen { display: none; }
  table {
    border-collapse: collapse;
    margin-top: 20px;
    width: 100%;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 12px 10px;
    text-align: center;
  }
  th { background-color: #007acc; color: white; }
  @media(max-width: 480px) {
    body { padding: 10px; }
    #container { padding: 20px 15px; }
    button { width: 100%; margin: 10px 0 0 0; }
  }
</style>
</head>
<body>
  <div id="container">

    <div id="startScreen">
      <h2>Cadastro do Morador</h2>
      <label for="name">Nome:</label>
      <input type="text" id="name" autocomplete="off" />

      <label for="age">Idade:</label>
      <input type="number" id="age" min="1" max="120" />

      <label for="tower">Torre (1 a 6):</label>
      <input type="number" id="tower" min="1" max="6" />

      <label for="apartment">Apartamento (ex: 101–108, 201–208, ..., 1201–1208):</label>
      <input type="number" id="apartment" />

      <button id="startBtn">Iniciar Quiz</button>
    </div>

    <div id="quizScreen">
      <div id="userInfo"></div>
      <h3>Pergunta <span id="qIndex"></span> de <span id="qTotal"></span></h3>
      <p id="questionText"></p>
      <button id="btnFraud">Fraude</button>
      <button id="btnSafe">Não é fraude</button>
      <div id="feedbackBox"></div>
      <button id="nextBtn" style="display:none;">Próxima</button>
      <p style="font-weight:600; margin-top: 15px;">Pontuação: <span id="score">0</span></p>
    </div>

    <div id="resultScreen">
      <h2 id="resTitle">Resultado Final</h2>
      <div id="resInfo">
        <p><strong>Nome:</strong> <span id="resName"></span></p>
        <p><strong>Torre:</strong> <span id="resTower"></span></p>
        <p><strong>Pontuação final:</strong> <span id="finalScore"></span></p>
      </div>

      <h3>Ranking dos moradores</h3>
      <table id="leaderboardTable" aria-label="Ranking dos moradores">
        <thead>
          <tr><th>Posição</th><th>Nome</th><th>Torre</th><th>Pontuação</th></tr>
        </thead>
        <tbody></tbody>
      </table>

      <h3>Desempenho por faixa etária</h3>
      <table id="ageStatsTable" aria-label="Desempenho por faixa etária">
        <thead>
          <tr><th>Faixa Etária</th><th>Quantidade</th><th>Média de Acertos</th><th>Percentual (%)</th></tr>
        </thead>
        <tbody></tbody>
      </table>

      <button id="restartBtn" style="margin-top:20px;">Reiniciar</button>
    </div>

  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

  // Configuração do Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyAtSr5znaGgvN9ZyITfCJzZD4jRpthAat0",
    authDomain: "trabalho-final-ohcao.firebaseapp.com",
    projectId: "trabalho-final-ohcao",
    storageBucket: "trabalho-final-ohcao.appspot.com",
    messagingSenderId: "588002956461",
    appId: "1:588002956461:web:12eec38aceece890e56224"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ================================
  //        CÓDIGO DO QUIZ
  // ================================

  const SCENARIOS = [
    { question: "Você recebe uma mensagem de um contato desconhecido pedindo dinheiro urgente. O que fazer?", correct: true, explanation: "É uma fraude comum se passar por conhecidos pedindo dinheiro. Nunca envie sem confirmar pessoalmente." },
    { question: "Um site pede para você atualizar seus dados bancários via link no e-mail. Isso é seguro?", correct: true, explanation: "Sites legítimos não pedem atualização via links em e-mails. Pode ser phishing." },
    { question: "Você recebeu um telefonema dizendo que ganhou um prêmio e precisa informar seus dados. É confiável?", correct: true, explanation: "Golpistas usam essa tática para coletar dados. Nunca forneça dados por telefone sem certeza." },
    { question: "Um aplicativo na loja oficial tem avaliações negativas dizendo que pode ser perigoso. Você deve instalar?", correct: true, explanation: "Avaliações negativas são um alerta. É melhor não instalar aplicativos suspeitos." },
    { question: "Uma mensagem do seu banco pede para confirmar uma transação via WhatsApp. Você deve confirmar?", correct: true, explanation: "Bancos nunca pedem confirmação de transação por WhatsApp. Pode ser golpe." },
    { question: "Você recebeu uma oferta de desconto muito grande em redes sociais, mas o link leva para um site estranho. Você deve clicar?", correct: true, explanation: "Links suspeitos podem roubar seus dados. Não clique em links de fontes desconhecidas." },
    { question: "Um site que você acessa frequentemente pediu para mudar sua senha por motivo de segurança. É recomendável?", correct: false, explanation: "Alterar senhas periodicamente é uma boa prática de segurança." },
    { question: "Usar senhas fortes e diferentes para cada serviço ajuda a proteger suas contas. Isso é verdade?", correct: false, explanation: "Senhas fortes e diferentes dificultam o acesso não autorizado." }
  ];

  let index = 0;
  let score = 0;
  let user = {};
  let isUninter = false;

  const startScreen = document.getElementById("startScreen");
  const quizScreen = document.getElementById("quizScreen");
  const resultScreen = document.getElementById("resultScreen");
  const questionText = document.getElementById("questionText");
  const qIndex = document.getElementById("qIndex");
  const qTotal = document.getElementById("qTotal");
  const scoreEl = document.getElementById("score");
  const feedbackBox = document.getElementById("feedbackBox");
  const nextBtn = document.getElementById("nextBtn");
  const btnFraud = document.getElementById("btnFraud");
  const btnSafe = document.getElementById("btnSafe");
  const userInfo = document.getElementById("userInfo");
  const ageStatsTableBody = document.querySelector("#ageStatsTable tbody");

  function showQuestion() {
    qIndex.textContent = index + 1;
    qTotal.textContent = SCENARIOS.length;
    questionText.textContent = SCENARIOS[index].question;
    feedbackBox.textContent = "";
    feedbackBox.className = "";
    nextBtn.style.display = "none";
    btnFraud.disabled = false;
    btnSafe.disabled = false;
  }

  function checkAnswer(userAnswer) {
    const current = SCENARIOS[index];
    btnFraud.disabled = true;
    btnSafe.disabled = true;

    if (userAnswer === current.correct) {
      score++;
      feedbackBox.textContent = "Correto! " + current.explanation;
      feedbackBox.className = "correct";
    } else {
      feedbackBox.textContent = "Errado! " + current.explanation;
      feedbackBox.className = "wrong";
    }
    scoreEl.textContent = score;
    nextBtn.style.display = "inline-block";
  }

  async function saveResultToFirebase() {
    try {
      await addDoc(collection(db, "quizResults"), {
        name: user.name,
        tower: user.tower,
        apartment: user.apartment,
        age: user.age,
        score: score,
        timestamp: new Date()
      });
      console.log("✅ Resultado salvo no Firestore!");
    } catch (e) {
      console.error("Erro ao salvar:", e);
    }
  }

  async function loadRankingFromFirebase() {
    const snapshot = await getDocs(collection(db, "quizResults"));
    let data = [];
    snapshot.forEach(doc => data.push(doc.data()));
    data.sort((a, b) => b.score - a.score);

    const tbody = document.querySelector("#leaderboardTable tbody");
    tbody.innerHTML = "";
    data.forEach((entry, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${i + 1}</td><td>${entry.name}</td><td>${entry.tower}</td><td>${entry.score}</td>`;
      tbody.appendChild(tr);
    });
  }

  function showResult() {
    startScreen.style.display = "none";
    quizScreen.style.display = "none";
    resultScreen.style.display = "block";

    if (isUninter) {
      document.getElementById("resInfo").style.display = "none";
      document.getElementById("resTitle").textContent = "Resumo dos Moradores";
    } else {
      document.getElementById("resName").textContent = user.name;
      document.getElementById("resTower").textContent = user.tower;
      document.getElementById("finalScore").textContent = score;
      saveResultToFirebase();
    }
    loadRankingFromFirebase();
  }

  function iniciarQuiz() {
    const name = document.getElementById("name").value.trim();
    const age = Number(document.getElementById("age").value);
    const tower = Number(document.getElementById("tower").value);
    const apartment = Number(document.getElementById("apartment").value);

    if (!name) { alert("Por favor, insira seu nome."); return; }

    if (name.toLowerCase() === "uninter") {
      isUninter = true;
    } else {
      if (!age || age < 1 || age > 120) { alert("Idade inválida."); return; }
      if (!tower || tower < 1 || tower > 6) { alert("Torre inválida."); return; }
      const andar = Math.floor(apartment / 100);
      const unidade = apartment % 100;
      if (!(andar >= 1 && andar <= 12 && unidade >= 1 && unidade <= 8)) {
        alert("Apartamento inválido."); return;
      }
    }

    user = { name, age, tower, apartment };
    index = 0;
    score = 0;

    startScreen.style.display = "none";
    quizScreen.style.display = "block";
    resultScreen.style.display = "none";

    userInfo.textContent = isUninter ? 
      "Modo UNINTER: visualização do quiz" :
      `Olá, ${name} (Torre ${tower}, Apt ${apartment})`;

    scoreEl.textContent = score;
    showQuestion();
  }

  document.getElementById("startBtn").addEventListener("click", iniciarQuiz);
  btnFraud.addEventListener("click", () => checkAnswer(true));
  btnSafe.addEventListener("click", () => checkAnswer(false));
  nextBtn.addEventListener("click", () => {
    index++;
    if (index >= SCENARIOS.length) showResult();
    else showQuestion();
  });
  document.getElementById("restartBtn").addEventListener("click", () => {
    startScreen.style.display = "block";
    quizScreen.style.display = "none";
    resultScreen.style.display = "none";
    document.getElementById("name").value = "";
    document.getElementById("age").value = "";
    document.getElementById("tower").value = "";
    document.getElementById("apartment").value = "";
    feedbackBox.textContent = "";
  });
</script>
</body>
</html>
