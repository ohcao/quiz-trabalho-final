<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quiz Seguran√ßa Digital - Terceira Idade</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f4f8;
    margin: 0; padding: 20px;
    color: #333;
    display: flex;
    justify-content: center;
  }
  #container {
    background: white;
    max-width: 600px;
    width: 100%;
    border-radius: 10px;
    padding: 25px 30px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
  h2, h3 { color: #005a87; }
  label { display: block; margin: 15px 0 5px; font-weight: 600; }
  input[type=text], input[type=number] {
    width: 100%;
    padding: 12px 10px;
    font-size: 1.1em;
    border: 1.8px solid #ccc;
    border-radius: 6px;
    transition: border-color 0.3s;
  }
  input[type=text]:focus, input[type=number]:focus {
    border-color: #005a87;
    outline: none;
  }
  button {
    cursor: pointer;
    margin: 10px 10px 0 0;
    padding: 12px 24px;
    font-size: 1.1em;
    border: none;
    border-radius: 7px;
    background-color: #007acc;
    color: white;
    transition: background-color 0.3s;
  }
  button:hover:not(:disabled) { background-color: #005a87; }
  button:disabled { background-color: #a3c1db; cursor: default; }
  #feedbackBox {
    margin-top: 15px;
    font-weight: 700;
    font-size: 1.1em;
  }
  #feedbackBox.correct { color: #2d7a2d; }
  #feedbackBox.wrong { color: #c0392b; }
  #userInfo {
    margin-bottom: 20px;
    font-weight: 600;
    color: #004c6d;
  }
  #quizScreen, #resultScreen { display: none; }
  table {
    border-collapse: collapse;
    margin-top: 20px;
    width: 100%;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 12px 10px;
    text-align: center;
  }
  th { background-color: #007acc; color: white; }
  @media(max-width: 480px) {
    body { padding: 10px; }
    #container { padding: 20px 15px; }
    button { width: 100%; margin: 10px 0 0 0; }
  }
</style>
</head>
<body>
  <div id="container">

    <div id="startScreen">
      <h2>Cadastro do Morador</h2>
      <label for="name">Nome:</label>
      <input type="text" id="name" autocomplete="off" />

      <label for="age">Idade:</label>
      <input type="number" id="age" min="1" max="120" />

      <label for="tower">Torre (1 a 6):</label>
      <input type="number" id="tower" min="1" max="6" />

      <label for="apartment">Apartamento (ex: 101‚Äì108, 201‚Äì208, ..., 1201‚Äì1208):</label>
      <input type="number" id="apartment" />

      <button id="startBtn">Iniciar Quiz</button>
    </div>

    <div id="quizScreen">
      <div id="userInfo"></div>
      <h3>Pergunta <span id="qIndex"></span> de <span id="qTotal"></span></h3>
      <p id="questionText"></p>
      <button id="btnFraud">Fraude</button>
      <button id="btnSafe">N√£o √© fraude</button>
      <div id="feedbackBox"></div>
      <button id="nextBtn" style="display:none;">Pr√≥xima</button>
      <p style="font-weight:600; margin-top: 15px;">Pontua√ß√£o: <span id="score">0</span></p>
    </div>

    <div id="resultScreen">
      <h2 id="resTitle">Resultado Final</h2>
      <div id="resInfo">
        <p><strong>Nome:</strong> <span id="resName"></span></p>
        <p><strong>Torre:</strong> <span id="resTower"></span></p>
        <p><strong>Pontua√ß√£o final:</strong> <span id="finalScore"></span></p>
      </div>

      <h3>Ranking dos moradores</h3>
      <table id="leaderboardTable" aria-label="Ranking dos moradores">
        <thead>
          <tr><th>Posi√ß√£o</th><th>Nome</th><th>Torre</th><th>Pontua√ß√£o</th></tr>
        </thead>
        <tbody></tbody>
      </table>

      <h3>Desempenho por faixa et√°ria</h3>
      <table id="ageStatsTable" aria-label="Desempenho por faixa et√°ria">
        <thead>
          <tr><th>Faixa Et√°ria</th><th>Quantidade</th><th>M√©dia de Acertos</th><th>Percentual (%)</th></tr>
        </thead>
        <tbody></tbody>
      </table>

      <button id="restartBtn" style="margin-top:20px;">Reiniciar</button>
    </div>

  </div>

<script>
// Perguntas fixas (8 perguntas)
const SCENARIOS = [
  {
    question: "Voc√™ recebe uma mensagem de um contato desconhecido pedindo dinheiro urgente. O que fazer?",
    correct: true,
    explanation: "√â uma fraude comum se passar por conhecidos pedindo dinheiro. Nunca envie sem confirmar pessoalmente."
  },
  {
    question: "Um site pede para voc√™ atualizar seus dados banc√°rios via link no e-mail. Isso √© seguro?",
    correct: true,
    explanation: "Sites leg√≠timos n√£o pedem atualiza√ß√£o via links em e-mails. Pode ser phishing."
  },
  {
    question: "Voc√™ recebeu um telefonema dizendo que ganhou um pr√™mio e precisa informar seus dados. √â confi√°vel?",
    correct: true,
    explanation: "Golpistas usam essa t√°tica para coletar dados. Nunca forne√ßa dados por telefone sem certeza."
  },
  {
    question: "Um aplicativo na loja oficial tem avalia√ß√µes negativas dizendo que pode ser perigoso. Voc√™ deve instalar?",
    correct: true,
    explanation: "Avalia√ß√µes negativas s√£o um alerta. √â melhor n√£o instalar aplicativos suspeitos."
  },
  {
    question: "Uma mensagem do seu banco pede para confirmar uma transa√ß√£o via WhatsApp. Voc√™ deve confirmar?",
    correct: true,
    explanation: "Bancos nunca pedem confirma√ß√£o de transa√ß√£o por WhatsApp. Pode ser golpe."
  },
  {
    question: "Voc√™ recebeu uma oferta de desconto muito grande em redes sociais, mas o link leva para um site estranho. Voc√™ deve clicar?",
    correct: true,
    explanation: "Links suspeitos podem roubar seus dados. N√£o clique em links de fontes desconhecidas."
  },
  {
    question: "Um site que voc√™ acessa frequentemente pediu para mudar sua senha por motivo de seguran√ßa. √â recomend√°vel?",
    correct: false,
    explanation: "Alterar senhas periodicamente √© uma boa pr√°tica de seguran√ßa."
  },
  {
    question: "Usar senhas fortes e diferentes para cada servi√ßo ajuda a proteger suas contas. Isso √© verdade?",
    correct: false,
    explanation: "Senhas fortes e diferentes dificultam o acesso n√£o autorizado."
  }
];

let index = 0;
let score = 0;
let user = {};
let isUninter = false;

const LB_KEY = "ranking_condominio_fixed";
const ANSWERED_KEY = "usuarios_respondidos_condominio";
const AGE_STATS_KEY = "estatisticas_idade_condominio";

const startScreen = document.getElementById("startScreen");
const quizScreen = document.getElementById("quizScreen");
const resultScreen = document.getElementById("resultScreen");
const questionText = document.getElementById("questionText");
const qIndex = document.getElementById("qIndex");
const qTotal = document.getElementById("qTotal");
const scoreEl = document.getElementById("score");
const feedbackBox = document.getElementById("feedbackBox");
const nextBtn = document.getElementById("nextBtn");
const btnFraud = document.getElementById("btnFraud");
const btnSafe = document.getElementById("btnSafe");
const userInfo = document.getElementById("userInfo");
const ageStatsTableBody = document.querySelector("#ageStatsTable tbody");

function jaRespondido(tower, apartment) {
  const respondedUsers = JSON.parse(localStorage.getItem(ANSWERED_KEY)) || [];
  return respondedUsers.some(entry => entry.tower === tower && entry.apartment === apartment);
}
function marcarRespondido(tower, apartment) {
  let respondedUsers = JSON.parse(localStorage.getItem(ANSWERED_KEY)) || [];
  respondedUsers.push({ tower, apartment });
  localStorage.setItem(ANSWERED_KEY, JSON.stringify(respondedUsers));
}

function showQuestion() {
  qIndex.textContent = index + 1;
  qTotal.textContent = SCENARIOS.length;
  questionText.textContent = SCENARIOS[index].question;
  feedbackBox.textContent = "";
  feedbackBox.className = "";
  nextBtn.style.display = "none";
  btnFraud.disabled = false;
  btnSafe.disabled = false;
}
function checkAnswer(userAnswer) {
  const current = SCENARIOS[index];
  btnFraud.disabled = true;
  btnSafe.disabled = true;

  if (userAnswer === current.correct) {
    score++;
    feedbackBox.textContent = "Correto! " + current.explanation;
    feedbackBox.className = "correct";
  } else {
    feedbackBox.textContent = "Errado! " + current.explanation;
    feedbackBox.className = "wrong";
  }
  scoreEl.textContent = score;
  nextBtn.style.display = "inline-block";
}

// üëâ Corrigido: atualiza estat√≠sticas sempre, mas s√≥ grava se n√£o for Uninter
function atualizarEstatisticasIdade() {
  let stats = JSON.parse(localStorage.getItem(AGE_STATS_KEY)) || [];

  if (!isUninter && user.age >= 60) {
    stats.push({ age: user.age, score: score });
    localStorage.setItem(AGE_STATS_KEY, JSON.stringify(stats));
  }

  const faixas = {
    "60 - 70": [],
    "71 - 80": [],
    "81 - 90": [],
    "Acima de 90": []
  };

  stats.forEach(e => {
    const a = e.age;
    if (a >= 60 && a <= 70) faixas["60 - 70"].push(e.score);
    else if (a >= 71 && a <= 80) faixas["71 - 80"].push(e.score);
    else if (a >= 81 && a <= 90) faixas["81 - 90"].push(e.score);
    else if (a > 90) faixas["Acima de 90"].push(e.score);
  });

  ageStatsTableBody.innerHTML = "";
  for (const faixa in faixas) {
    const valores = faixas[faixa];
    if (valores.length === 0) {
      ageStatsTableBody.innerHTML += `<tr><td>${faixa}</td><td>0</td><td>-</td><td>-</td></tr>`;
      continue;
    }
    const media = valores.reduce((a,b)=>a+b,0)/valores.length;
    const percentual = ((media / SCENARIOS.length) * 100).toFixed(1);
    ageStatsTableBody.innerHTML += `<tr><td>${faixa}</td><td>${valores.length}</td><td>${media.toFixed(2)}</td><td>${percentual}</td></tr>`;
  }
}

function showResult() {
  startScreen.style.display = "none";
  quizScreen.style.display = "none";
  resultScreen.style.display = "block";

  const resInfo = document.getElementById("resInfo");
  const resTitle = document.getElementById("resTitle");

  if (isUninter) {
    resInfo.style.display = "none";
    resTitle.textContent = "Resumo dos Moradores";
  } else {
    document.getElementById("resName").textContent = user.name;
    document.getElementById("resTower").textContent = user.tower;
    document.getElementById("finalScore").textContent = score;
    marcarRespondido(user.tower, user.apartment);
  }

  let ranking = JSON.parse(localStorage.getItem(LB_KEY)) || [];
  if (!isUninter) {
    ranking.push({ name: user.name, tower: user.tower, score });
    ranking.sort((a,b)=>b.score - a.score);
    localStorage.setItem(LB_KEY, JSON.stringify(ranking));
  }

  const tbody = document.querySelector("#leaderboardTable tbody");
  tbody.innerHTML = "";
  ranking.forEach((entry, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${i+1}</td><td>${entry.name}</td><td>${entry.tower}</td><td>${entry.score}</td>`;
    tbody.appendChild(tr);
  });

  atualizarEstatisticasIdade();
}

function iniciarQuiz() {
  const name = document.getElementById("name").value.trim();
  const age = Number(document.getElementById("age").value);
  const tower = Number(document.getElementById("tower").value);
  const apartment = Number(document.getElementById("apartment").value);

  if (!name) { alert("Por favor, insira seu nome."); return; }

  if (name.toLowerCase() === "uninter") {
    isUninter = true;
  } else {
    isUninter = false;
    if (!age || age < 1 || age > 120) { alert("Idade inv√°lida."); return; }
    if (!tower || tower < 1 || tower > 6) { alert("Torre inv√°lida."); return; }

    const andar = Math.floor(apartment / 100);
    const unidade = apartment % 100;
    const andarValido = andar >= 1 && andar <= 12;
    const unidadeValida = unidade >= 1 && unidade <= 8;

    if (!andarValido || !unidadeValida) {
      alert("Apartamento inv√°lido. Use apenas 101‚Äì108, 201‚Äì208, ..., 1201‚Äì1208.");
      return;
    }

    if (jaRespondido(tower, apartment)) {
      alert("Este apartamento j√° respondeu ao quiz.");
      return;
    }
  }

  user = { name, age, tower, apartment };
  index = 0;
  score = 0;

  startScreen.style.display = "none";
  quizScreen.style.display = "block";
  resultScreen.style.display = "none";

  userInfo.textContent = isUninter ? 
    "Modo UNINTER: visualiza√ß√£o do quiz" :
    `Ol√°, ${name} (Torre ${tower}, Apt ${apartment})`;

  scoreEl.textContent = score;
  showQuestion();
}

document.getElementById("startBtn").addEventListener("click", iniciarQuiz);
btnFraud.addEventListener("click", () => checkAnswer(true));
btnSafe.addEventListener("click", () => checkAnswer(false));
nextBtn.addEventListener("click", () => {
  index++;
  if (index >= SCENARIOS.length) showResult();
  else showQuestion();
});
document.getElementById("restartBtn").addEventListener("click", () => {
  startScreen.style.display = "block";
  quizScreen.style.display = "none";
  resultScreen.style.display = "none";
  document.getElementById("name").value = "";
  document.getElementById("age").value = "";
  document.getElementById("tower").value = "";
  document.getElementById("apartment").value = "";
  feedbackBox.textContent = "";
  ageStatsTableBody.innerHTML = "";
});
</script>
</body>
</html>
